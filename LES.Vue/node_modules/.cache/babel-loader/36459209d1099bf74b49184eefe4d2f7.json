{"remainingRequest":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\babel-loader\\lib\\index.js!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\src\\views\\LoginCallbackView.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\src\\views\\LoginCallbackView.vue","mtime":1610332596000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport _parseInt from \"D:\\\\\\u6570\\u701B\\u4FE1\\u606F\\u79D1\\u6280\\\\\\u516C\\u53F8\\u9879\\u76EE\\\\\\u5E7F\\u5DDE\\u897F\\u95E8\\u5B50\\u539F\\u6750\\u6599\\u7ACB\\u4F53\\u5E93\\\\\\u4F4E\\u538B\\u7EBF\\u5708\\\\src\\\\Blog.Admin-master\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/parse-int\";\nimport _JSON$stringify from \"D:\\\\\\u6570\\u701B\\u4FE1\\u606F\\u79D1\\u6280\\\\\\u516C\\u53F8\\u9879\\u76EE\\\\\\u5E7F\\u5DDE\\u897F\\u95E8\\u5B50\\u539F\\u6750\\u6599\\u7ACB\\u4F53\\u5E93\\\\\\u4F4E\\u538B\\u7EBF\\u5708\\\\src\\\\Blog.Admin-master\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/json/stringify\";\nimport \"core-js/modules/es6.string.sub\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:\\\\\\u6570\\u701B\\u4FE1\\u606F\\u79D1\\u6280\\\\\\u516C\\u53F8\\u9879\\u76EE\\\\\\u5E7F\\u5DDE\\u897F\\u95E8\\u5B50\\u539F\\u6750\\u6599\\u7ACB\\u4F53\\u5E93\\\\\\u4F4E\\u538B\\u7EBF\\u5708\\\\src\\\\Blog.Admin-master\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport applicationUserManager from \"../Auth/applicationusermanager\";\nimport { requestLogin, requestLoginMock, getUserByToken, getNavigationBar } from \"../api/api\";\nimport router from \"@/router\";\nimport { resetRouter, filterAsyncRouter } from \"@/router/index\";\nexport default {\n  name: \"logincallback-view\",\n  data: function data() {\n    return {};\n  },\n  created: function () {\n    var _created = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var _this, user, curTime, expiredate;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return applicationUserManager.signinRedirectCallback();\n\n            case 3:\n              _this = this;\n              _context.next = 6;\n              return applicationUserManager.getUser();\n\n            case 6:\n              user = _context.sent;\n\n              _this.$store.commit(\"saveToken\", user.access_token);\n\n              curTime = new Date();\n              expiredate = new Date(curTime.setSeconds(curTime.getSeconds() + user.expires_in));\n\n              _this.$store.commit(\"saveTokenExpire\", expiredate);\n\n              window.localStorage.refreshtime = expiredate;\n              window.localStorage.expires_in = user.expires_in;\n\n              _this.$notify({\n                type: \"success\",\n                message: \"\\u6210\\u529F\\u83B7\\u53D6\\u4EE4\\u724C\\uFF0C\\u9879\\u76EE\\u521D\\u59CB\\u5316\\u4E2D...\",\n                duration: 3000\n              });\n\n              user.uRealName = user.profile.name;\n              user.uLoginName = user.profile.preferred_username;\n              user.uID = user.profile.sub;\n              window.localStorage.user = _JSON$stringify(user);\n\n              if (user.uID > 0) {\n                _this.GetNavigationBar(user.uID);\n              }\n\n              _context.next = 24;\n              break;\n\n            case 21:\n              _context.prev = 21;\n              _context.t0 = _context[\"catch\"](0);\n              this.$root.$emit(\"show-snackbar\", {\n                message: _context.t0\n              });\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[0, 21]]);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  methods: {\n    // 获取路由树\n    GetNavigationBar: function GetNavigationBar(uid) {\n      var _this = this;\n\n      var loginParams = {\n        uid: uid,\n        t: new Date()\n      };\n      getNavigationBar(loginParams).then(function (data) {\n        if (!data.success) {\n          _this.$message({\n            message: data.message,\n            type: \"error\"\n          });\n        } else {\n          // _this.closeAlert()\n          _this.$message({\n            message: \"后台初始化成功\",\n            type: \"success\"\n          });\n\n          var userinfo = JSON.parse(window.localStorage.user ? window.localStorage.user : null);\n\n          _this.$notify({\n            type: \"success\",\n            message: \"\\u767B\\u5F55\\u6210\\u529F \\n \\u6B22\\u8FCE\\u7BA1\\u7406\\u5458\\uFF1A\".concat(userinfo.uRealName, \" \\uFF01Token \\u5C06\\u5728 \").concat(_parseInt(window.localStorage.expires_in / 60), \" \\u5206\\u949F\\u540E\\u8FC7\\u671F\\uFF01\"),\n            duration: 6000\n          });\n\n          window.localStorage.router = _JSON$stringify(data.response.children);\n          var getRouter = data.response.children; //后台拿到路由\n\n          getRouter = filterAsyncRouter(getRouter); //过滤路由\n\n          router.$addRoutes(getRouter); //动态添加路由\n\n          _this.$router.replace(_this.$route.query.redirect ? _this.$route.query.redirect : \"/\");\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["LoginCallbackView.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div desktop=\"12\" tablet=\"8\">\n      <dl>\n        <dt>Login successful</dt>\n        <dt>Your browser should be redirected soon</dt>\n      </dl>\n    </div>\n  </div>\n</template>\n\n<script>\nimport applicationUserManager from \"../Auth/applicationusermanager\";\n\nimport {\n  requestLogin,\n  requestLoginMock,\n  getUserByToken,\n  getNavigationBar\n} from \"../api/api\";\n\nimport router from \"@/router\";\nimport { resetRouter, filterAsyncRouter } from \"@/router/index\";\n\nexport default {\n  name: \"logincallback-view\",\n  data() {\n    return {};\n  },\n  async created() {\n    try {\n      await applicationUserManager.signinRedirectCallback();\n      let _this = this;\n      let user = await applicationUserManager.getUser();\n      _this.$store.commit(\"saveToken\", user.access_token);\n\n      var curTime = new Date();\n      var expiredate = new Date(\n        curTime.setSeconds(curTime.getSeconds() + user.expires_in)\n      );\n      _this.$store.commit(\"saveTokenExpire\", expiredate);\n\n      window.localStorage.refreshtime = expiredate;\n      window.localStorage.expires_in = user.expires_in;\n\n      _this.$notify({\n        type: \"success\",\n        message: `成功获取令牌，项目初始化中...`,\n        duration: 3000\n      });\n      \n      user.uRealName=user.profile.name;\n      user.uLoginName=user.profile.preferred_username;\n      user.uID=user.profile.sub;\n      window.localStorage.user = JSON.stringify(user);\n      if (user.uID > 0) {\n        _this.GetNavigationBar(user.uID);\n      }\n\n    } catch (e) {\n      this.$root.$emit(\"show-snackbar\", { message: e });\n    }\n  },\n  methods: {\n    // 获取路由树\n    GetNavigationBar(uid) {\n      var _this = this;\n      var loginParams = { uid: uid, t: new Date() };\n\n      getNavigationBar(loginParams).then(data => {\n\n        if (!data.success) {\n          _this.$message({\n            message: data.message,\n            type: \"error\"\n          });\n        } else {\n          // _this.closeAlert()\n\n          _this.$message({\n            message: \"后台初始化成功\",\n            type: \"success\"\n          });\n          let userinfo = JSON.parse(\n            window.localStorage.user ? window.localStorage.user : null\n          );\n          _this.$notify({\n            type: \"success\",\n            message: `登录成功 \\n 欢迎管理员：${\n              userinfo.uRealName\n            } ！Token 将在 ${parseInt(window.localStorage.expires_in / 60)} 分钟后过期！`,\n            duration: 6000\n          });\n\n          window.localStorage.router = JSON.stringify(data.response.children);\n\n          let getRouter = data.response.children; //后台拿到路由\n          getRouter = filterAsyncRouter(getRouter); //过滤路由\n          router.$addRoutes(getRouter); //动态添加路由\n\n          _this.$router.replace(\n            _this.$route.query.redirect ? _this.$route.query.redirect : \"/\"\n          );\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style>\n</style>\n"],"sourceRoot":"src\\views"}]}