{"remainingRequest":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\src\\views\\System\\My.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\src\\views\\System\\My.vue","mtime":1612162898551},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport { md5Password, updatePerson, uploadPicUrl, removePic } from '../../api/api';\n\nexport default {\n  data () {\n    return {\n      uploadPicUrl: uploadPicUrl,\n      editForm: {\n        isUpdatePWD: false,//是否需要修改密码\n        uRemark: \"\",\n        id: 0,\n        uID: 0,\n        RID: 0,\n        uLoginName: \"\",\n        uRealName: \"\",\n        name: \"\",\n        sex: -1,\n        age: 0,\n        birth: \"\",\n        desc: \"\",\n        addr: \"\",\n        tdLogo: \"\" //头像地址\n      },\n      token: {\n        Authorization: \"Bearer \"\n      },\n      ruleForm: {\n        max_ver: \"\",\n        min_ver: \"\",\n        enable: \"\"\n      },\n      beforeAvatarUpload (file) {\n        const isJPG = file.type === \"image/jpeg\";\n        const isLt1M = file.size / 1024 / 1024 < 1;\n\n        // if (!isJPG) {\n        //   this.$message.error('上传头像图片只能是 JPG 格式!')\n        // }\n        if (!isLt1M) {\n          this.$message.error(\"上传头像图片大小不能超过 1MB!\");\n        }\n        return isLt1M;\n      }\n    };\n  },\n  methods: {\n    //删除图片\n    removeLogo () {\n      let para = {\n        path: this.editForm.tdLogo\n      };\n      removePic(para).then((res) => {\n        if (res.data.success) {\n          this.editForm.tdLogo = ''\n          this.$message({\n            message: '移除头像成功！',\n            type: 'success'\n          });\n        }\n        else {\n          this.$message({\n            message: res.data.msg,\n            type: 'error'\n          });\n        }\n      });\n\n    },\n    onSubmit () {\n      let myEditForm = this.editForm\n      if (!(myEditForm.uLoginPWDNew == undefined || myEditForm.uLoginPWDNew == '')\n        && (myEditForm.uLoginPWDConfirm == undefined || myEditForm.uLoginPWDConfirm == '')) {\n        //只有都为空的时候，才认为不修改密码\n        if (myEditForm.uLoginPWDNew == undefined || myEditForm.uLoginPWDNew == '') {\n          this.$message({\n            message: \"验证失败！新密码不能为空\",\n            type: \"error\"\n          });\n          return;\n        }\n        //验证新密码和确认密码是否一致\n        if (myEditForm.uLoginPWDNew != myEditForm.uLoginPWDConfirm) {\n          this.$message({\n            message: \"验证失败！新密码和确认密码不相同\",\n            type: \"error\"\n          });\n          return;\n        }\n        this.editForm.isUpdatePWD = true;\n        let para = {\n          password: this.editForm.uLoginPWD\n        }\n        md5Password(para).then((res) => {\n          var user = JSON.parse(window.localStorage.user);\n          if (res != user.uLoginPWD) {\n            this.$message({\n              message: \"验证失败！旧密码不正确\",\n              type: \"error\"\n            });\n            return;\n          }\n          //密码验证成功后\n          let para = Object.assign({}, this.editForm);\n          updatePerson(para).then((res) => {\n            if (res.data.success) {\n              this.$message({\n                message: res.data.msg + ',请重新登录',\n                type: 'success'\n              });\n            }\n            else {\n              this.$message({\n                message: res.data.msg,\n                type: 'error'\n              });\n            }\n          });\n        });\n      } else {\n        //不修改密码\n        this.editForm.isUpdatePWD = false;\n        let para = Object.assign({}, this.editForm);\n        updatePerson(para).then((res) => {\n          if (res.data.success) {\n            this.$message({\n              message: res.data.msg + ',请重新登录',\n              type: 'success'\n            });\n          }\n          else {\n            this.$message({\n              message: res.data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    handleAvatarSuccess (res, file) {\n      this.editForm.tdLogo = \"/\" + res.response;\n    },\n    fileDownload () {\n      let self = this\n      let token = \"132465\"\n      // 将token放到头中，设置下载进度、请求参数、返回类型\n      axios({\n        url: '/images/Down/Bmd?filename=' + self.rulesForm.data.ItemBmdPath,\n        method: 'get',\n        headers: { 'FileToken': token },\n        onDownloadProgress: p => {\n          // this.precent = Math.floor(100 * (p.loaded / p.total))\n        },\n        responseType: 'blob'\n      }).then(data => {\n        // 如果后端用encodeURI对文件名进行了编码，前端需用decodeURI进行解码（主要为处理特殊字符）\n        let fileName = decodeURI(data.headers.filename)\n        // 由于ie不支持download属性，故需要做兼容判断\n        if (navigator.appVersion.toString().indexOf('.NET') > 0) {\n          // ie独有的msSaveBlob属性，data.data为Blob文件流\n          window.navigator.msSaveBlob(data.data, fileName)\n        } else {\n          // 以下流程即为文章开始的下载流程\n          let url = window.URL.createObjectURL(data.data)\n          let link = document.createElement('a')\n          link.style.display = 'none'\n          link.href = url\n          link.download = fileName\n          document.body.appendChild(link)\n          link.click()\n          window.URL.revokeObjectURL(link.href);\n        }\n      })\n    }\n  },\n  mounted () {\n    let tokenStr = window.localStorage.Token;\n    this.token = {\n      Authorization: \"Bearer \" + tokenStr\n    };\n\n    var user = JSON.parse(window.localStorage.user);\n    console.log(user)\n    this.editForm.uRealName = user ? user.uRealName : \"\";\n    this.editForm.uRemark = user ? user.uRemark : \"\";\n    this.editForm.uID = user ? user.uID : \"\";\n    this.editForm.tdLogo = user ? user.tdLogo : \"\";\n  }\n};\n",{"version":3,"sources":["My.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"My.vue","sourceRoot":"src\\views\\System","sourcesContent":["<template>\n  <el-form ref=\"editForm\"\n           :model=\"editForm\"\n           label-width=\"80px\"\n           @submit.prevent=\"onSubmit\"\n           style=\"margin:20px;width:60%;min-width:600px;height:1000px;\">\n    <el-form-item label=\"我的昵称\">\n      <el-input v-model=\"editForm.uRealName\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"旧密码\"\n                  prop=\"uLoginPWD\">\n      <el-input v-model=\"editForm.uLoginPWD\"\n                show-password\n                auto-complete=\"off\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"新密码\"\n                  prop=\"uLoginPWDNew\">\n      <el-input v-model=\"editForm.uLoginPWDNew\"\n                show-password\n                auto-complete=\"off\"></el-input>\n    </el-form-item>\n    <el-form-item label=\"确认密码\"\n                  prop=\"uLoginPWDConfirm\">\n      <el-input v-model=\"editForm.uLoginPWDConfirm\"\n                show-password\n                auto-complete=\"off\"></el-input>\n    </el-form-item>\n\n    <el-form-item label=\"头像\">\n      <el-upload class=\"avatar-uploader\"\n                 :action=\"uploadPicUrl\"\n                 :show-file-list=\"false\"\n                 :headers=\"token\"\n                 :data=\"ruleForm\"\n                 :on-success=\"handleAvatarSuccess\"\n                 :before-upload=\"beforeAvatarUpload\">\n        <img v-if=\"editForm.tdLogo\"\n             :src=\"editForm.tdLogo\"\n             class=\"avatar\" />\n        <i v-else\n           class=\"el-icon-plus avatar-uploader-icon plus-sign\"></i>\n      </el-upload>\n      <el-button type=\"danger\"\n                 @click=\"removeLogo\">移除头像</el-button>\n    </el-form-item>\n\n    <el-form-item label=\"备注\"\n                  prop=\"uRemark\">\n      <el-input type=\"textarea\"\n                auto-complete=\"off\"\n                v-model=\"editForm.uRemark\"></el-input>\n    </el-form-item>\n    <el-form-item>\n      <el-button @click=\"onSubmit\"\n                 type=\"primary\">更新</el-button>\n      <el-button @click.native.prevent>取消</el-button>\n    </el-form-item>\n  </el-form>\n</template>\n\n<script>\n\nimport { md5Password, updatePerson, uploadPicUrl, removePic } from '../../api/api';\n\nexport default {\n  data () {\n    return {\n      uploadPicUrl: uploadPicUrl,\n      editForm: {\n        isUpdatePWD: false,//是否需要修改密码\n        uRemark: \"\",\n        id: 0,\n        uID: 0,\n        RID: 0,\n        uLoginName: \"\",\n        uRealName: \"\",\n        name: \"\",\n        sex: -1,\n        age: 0,\n        birth: \"\",\n        desc: \"\",\n        addr: \"\",\n        tdLogo: \"\" //头像地址\n      },\n      token: {\n        Authorization: \"Bearer \"\n      },\n      ruleForm: {\n        max_ver: \"\",\n        min_ver: \"\",\n        enable: \"\"\n      },\n      beforeAvatarUpload (file) {\n        const isJPG = file.type === \"image/jpeg\";\n        const isLt1M = file.size / 1024 / 1024 < 1;\n\n        // if (!isJPG) {\n        //   this.$message.error('上传头像图片只能是 JPG 格式!')\n        // }\n        if (!isLt1M) {\n          this.$message.error(\"上传头像图片大小不能超过 1MB!\");\n        }\n        return isLt1M;\n      }\n    };\n  },\n  methods: {\n    //删除图片\n    removeLogo () {\n      let para = {\n        path: this.editForm.tdLogo\n      };\n      removePic(para).then((res) => {\n        if (res.data.success) {\n          this.editForm.tdLogo = ''\n          this.$message({\n            message: '移除头像成功！',\n            type: 'success'\n          });\n        }\n        else {\n          this.$message({\n            message: res.data.msg,\n            type: 'error'\n          });\n        }\n      });\n\n    },\n    onSubmit () {\n      let myEditForm = this.editForm\n      if (!(myEditForm.uLoginPWDNew == undefined || myEditForm.uLoginPWDNew == '')\n        && (myEditForm.uLoginPWDConfirm == undefined || myEditForm.uLoginPWDConfirm == '')) {\n        //只有都为空的时候，才认为不修改密码\n        if (myEditForm.uLoginPWDNew == undefined || myEditForm.uLoginPWDNew == '') {\n          this.$message({\n            message: \"验证失败！新密码不能为空\",\n            type: \"error\"\n          });\n          return;\n        }\n        //验证新密码和确认密码是否一致\n        if (myEditForm.uLoginPWDNew != myEditForm.uLoginPWDConfirm) {\n          this.$message({\n            message: \"验证失败！新密码和确认密码不相同\",\n            type: \"error\"\n          });\n          return;\n        }\n        this.editForm.isUpdatePWD = true;\n        let para = {\n          password: this.editForm.uLoginPWD\n        }\n        md5Password(para).then((res) => {\n          var user = JSON.parse(window.localStorage.user);\n          if (res != user.uLoginPWD) {\n            this.$message({\n              message: \"验证失败！旧密码不正确\",\n              type: \"error\"\n            });\n            return;\n          }\n          //密码验证成功后\n          let para = Object.assign({}, this.editForm);\n          updatePerson(para).then((res) => {\n            if (res.data.success) {\n              this.$message({\n                message: res.data.msg + ',请重新登录',\n                type: 'success'\n              });\n            }\n            else {\n              this.$message({\n                message: res.data.msg,\n                type: 'error'\n              });\n            }\n          });\n        });\n      } else {\n        //不修改密码\n        this.editForm.isUpdatePWD = false;\n        let para = Object.assign({}, this.editForm);\n        updatePerson(para).then((res) => {\n          if (res.data.success) {\n            this.$message({\n              message: res.data.msg + ',请重新登录',\n              type: 'success'\n            });\n          }\n          else {\n            this.$message({\n              message: res.data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    handleAvatarSuccess (res, file) {\n      this.editForm.tdLogo = \"/\" + res.response;\n    },\n    fileDownload () {\n      let self = this\n      let token = \"132465\"\n      // 将token放到头中，设置下载进度、请求参数、返回类型\n      axios({\n        url: '/images/Down/Bmd?filename=' + self.rulesForm.data.ItemBmdPath,\n        method: 'get',\n        headers: { 'FileToken': token },\n        onDownloadProgress: p => {\n          // this.precent = Math.floor(100 * (p.loaded / p.total))\n        },\n        responseType: 'blob'\n      }).then(data => {\n        // 如果后端用encodeURI对文件名进行了编码，前端需用decodeURI进行解码（主要为处理特殊字符）\n        let fileName = decodeURI(data.headers.filename)\n        // 由于ie不支持download属性，故需要做兼容判断\n        if (navigator.appVersion.toString().indexOf('.NET') > 0) {\n          // ie独有的msSaveBlob属性，data.data为Blob文件流\n          window.navigator.msSaveBlob(data.data, fileName)\n        } else {\n          // 以下流程即为文章开始的下载流程\n          let url = window.URL.createObjectURL(data.data)\n          let link = document.createElement('a')\n          link.style.display = 'none'\n          link.href = url\n          link.download = fileName\n          document.body.appendChild(link)\n          link.click()\n          window.URL.revokeObjectURL(link.href);\n        }\n      })\n    }\n  },\n  mounted () {\n    let tokenStr = window.localStorage.Token;\n    this.token = {\n      Authorization: \"Bearer \" + tokenStr\n    };\n\n    var user = JSON.parse(window.localStorage.user);\n    console.log(user)\n    this.editForm.uRealName = user ? user.uRealName : \"\";\n    this.editForm.uRemark = user ? user.uRemark : \"\";\n    this.editForm.uID = user ? user.uID : \"\";\n    this.editForm.tdLogo = user ? user.tdLogo : \"\";\n  }\n};\n</script>\n\n<style>\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n\n.avatar-uploader .el-upload:hover {\n  border-color: #409eff;\n}\n\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  width: 120px;\n  height: 120px;\n  text-align: center;\n}\n.plus-sign {\n  line-height: 120px !important;\n}\n.avatar {\n  width: 120px;\n  height: 120px;\n  display: block;\n}\n\n.markdown-body {\n  height: 500px !important;\n}\n</style>"]}]}