{"remainingRequest":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\src\\views\\LoginCallbackView.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\src\\views\\LoginCallbackView.vue","mtime":1610332596000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\Blog.Admin-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport applicationUserManager from \"../Auth/applicationusermanager\";\n\nimport {\n  requestLogin,\n  requestLoginMock,\n  getUserByToken,\n  getNavigationBar\n} from \"../api/api\";\n\nimport router from \"@/router\";\nimport { resetRouter, filterAsyncRouter } from \"@/router/index\";\n\nexport default {\n  name: \"logincallback-view\",\n  data() {\n    return {};\n  },\n  async created() {\n    try {\n      await applicationUserManager.signinRedirectCallback();\n      let _this = this;\n      let user = await applicationUserManager.getUser();\n      _this.$store.commit(\"saveToken\", user.access_token);\n\n      var curTime = new Date();\n      var expiredate = new Date(\n        curTime.setSeconds(curTime.getSeconds() + user.expires_in)\n      );\n      _this.$store.commit(\"saveTokenExpire\", expiredate);\n\n      window.localStorage.refreshtime = expiredate;\n      window.localStorage.expires_in = user.expires_in;\n\n      _this.$notify({\n        type: \"success\",\n        message: `成功获取令牌，项目初始化中...`,\n        duration: 3000\n      });\n      \n      user.uRealName=user.profile.name;\n      user.uLoginName=user.profile.preferred_username;\n      user.uID=user.profile.sub;\n      window.localStorage.user = JSON.stringify(user);\n      if (user.uID > 0) {\n        _this.GetNavigationBar(user.uID);\n      }\n\n    } catch (e) {\n      this.$root.$emit(\"show-snackbar\", { message: e });\n    }\n  },\n  methods: {\n    // 获取路由树\n    GetNavigationBar(uid) {\n      var _this = this;\n      var loginParams = { uid: uid, t: new Date() };\n\n      getNavigationBar(loginParams).then(data => {\n\n        if (!data.success) {\n          _this.$message({\n            message: data.message,\n            type: \"error\"\n          });\n        } else {\n          // _this.closeAlert()\n\n          _this.$message({\n            message: \"后台初始化成功\",\n            type: \"success\"\n          });\n          let userinfo = JSON.parse(\n            window.localStorage.user ? window.localStorage.user : null\n          );\n          _this.$notify({\n            type: \"success\",\n            message: `登录成功 \\n 欢迎管理员：${\n              userinfo.uRealName\n            } ！Token 将在 ${parseInt(window.localStorage.expires_in / 60)} 分钟后过期！`,\n            duration: 6000\n          });\n\n          window.localStorage.router = JSON.stringify(data.response.children);\n\n          let getRouter = data.response.children; //后台拿到路由\n          getRouter = filterAsyncRouter(getRouter); //过滤路由\n          router.$addRoutes(getRouter); //动态添加路由\n\n          _this.$router.replace(\n            _this.$route.query.redirect ? _this.$route.query.redirect : \"/\"\n          );\n        }\n      });\n    }\n  }\n};\n",{"version":3,"sources":["LoginCallbackView.vue"],"names":[],"mappings":";;;;;;;;;;;;AAYA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginCallbackView.vue","sourceRoot":"src\\views","sourcesContent":["<template>\n  <div>\n    <div desktop=\"12\" tablet=\"8\">\n      <dl>\n        <dt>Login successful</dt>\n        <dt>Your browser should be redirected soon</dt>\n      </dl>\n    </div>\n  </div>\n</template>\n\n<script>\nimport applicationUserManager from \"../Auth/applicationusermanager\";\n\nimport {\n  requestLogin,\n  requestLoginMock,\n  getUserByToken,\n  getNavigationBar\n} from \"../api/api\";\n\nimport router from \"@/router\";\nimport { resetRouter, filterAsyncRouter } from \"@/router/index\";\n\nexport default {\n  name: \"logincallback-view\",\n  data() {\n    return {};\n  },\n  async created() {\n    try {\n      await applicationUserManager.signinRedirectCallback();\n      let _this = this;\n      let user = await applicationUserManager.getUser();\n      _this.$store.commit(\"saveToken\", user.access_token);\n\n      var curTime = new Date();\n      var expiredate = new Date(\n        curTime.setSeconds(curTime.getSeconds() + user.expires_in)\n      );\n      _this.$store.commit(\"saveTokenExpire\", expiredate);\n\n      window.localStorage.refreshtime = expiredate;\n      window.localStorage.expires_in = user.expires_in;\n\n      _this.$notify({\n        type: \"success\",\n        message: `成功获取令牌，项目初始化中...`,\n        duration: 3000\n      });\n      \n      user.uRealName=user.profile.name;\n      user.uLoginName=user.profile.preferred_username;\n      user.uID=user.profile.sub;\n      window.localStorage.user = JSON.stringify(user);\n      if (user.uID > 0) {\n        _this.GetNavigationBar(user.uID);\n      }\n\n    } catch (e) {\n      this.$root.$emit(\"show-snackbar\", { message: e });\n    }\n  },\n  methods: {\n    // 获取路由树\n    GetNavigationBar(uid) {\n      var _this = this;\n      var loginParams = { uid: uid, t: new Date() };\n\n      getNavigationBar(loginParams).then(data => {\n\n        if (!data.success) {\n          _this.$message({\n            message: data.message,\n            type: \"error\"\n          });\n        } else {\n          // _this.closeAlert()\n\n          _this.$message({\n            message: \"后台初始化成功\",\n            type: \"success\"\n          });\n          let userinfo = JSON.parse(\n            window.localStorage.user ? window.localStorage.user : null\n          );\n          _this.$notify({\n            type: \"success\",\n            message: `登录成功 \\n 欢迎管理员：${\n              userinfo.uRealName\n            } ！Token 将在 ${parseInt(window.localStorage.expires_in / 60)} 分钟后过期！`,\n            duration: 6000\n          });\n\n          window.localStorage.router = JSON.stringify(data.response.children);\n\n          let getRouter = data.response.children; //后台拿到路由\n          getRouter = filterAsyncRouter(getRouter); //过滤路由\n          router.$addRoutes(getRouter); //动态添加路由\n\n          _this.$router.replace(\n            _this.$route.query.redirect ? _this.$route.query.redirect : \"/\"\n          );\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style>\n</style>\n"]}]}