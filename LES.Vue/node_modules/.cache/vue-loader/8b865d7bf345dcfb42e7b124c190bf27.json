{"remainingRequest":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\src\\views\\Permission\\Assign.vue?vue&type=style&index=0&id=e83f89f6&scoped=true&lang=css&","dependencies":[{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\src\\views\\Permission\\Assign.vue","mtime":1612257913762},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\数瀛信息科技\\公司项目\\广州西门子原材料立体库\\低压线圈\\src\\LES.Vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.content-az {\n  height: calc(\n    100% - 61px\n  ) !important; /* 修改该样式，改为1px [EditBy shaocx,2021-02-02] */\n}\n",{"version":3,"sources":["Assign.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsVA;AACA;AACA;AACA;AACA","file":"Assign.vue","sourceRoot":"src\\views\\Permission","sourcesContent":["<template>\n  <section>\n    <!--工具条-->\n    <el-col :span=\"8\"\n            class=\"toolbar roles\">\n      <el-card class=\"box-card\">\n        <div slot=\"header\"\n             class=\"clearfix\">\n          <span>权限</span>\n          <el-button @click=\"getRoles\"\n                     style=\"float: right; padding: 3px 0\"\n                     type=\"text\">刷新</el-button>\n        </div>\n        <div v-for=\"o in roles\"\n             :key=\"o.Id\"\n             @click=\"operate(o.Id)\"\n             :class=\"o.Id==roleid ? 'active':''\"\n             class=\"text item role-item\">\n          {{o.Name }}\n        </div>\n      </el-card>\n\n    </el-col>\n    <el-col :span=\"16\"\n            class=\"toolbar perms morechildren\">\n      <el-card class=\"box-card\">\n        <div slot=\"header\"\n             class=\"clearfix\">\n          <span>菜单</span>\n          <el-button :loading=\"loadingSave\"\n                     @click=\"saveAssign\"\n                     style=\"float: right; padding: 3px 0\"\n                     type=\"text\">{{loadingSaveStr}}</el-button>\n        </div>\n        <div class=\"block\">\n          <!--<el-tree :data=\"data5\" size=\"mini\" show-checkbox node-key=\"value\" :props=\"defaultProps\"-->\n          <!--style=\"width: 100%;pading-top:20px;\" default-expand-all ref=\"menuTree\" :render-content=\"renderContent\"-->\n          <!--element-loading-text=\"拼命加载中\" :check-strictly=\"true\"-->\n          <!--@check-change=\"handleMenuCheckChange\">-->\n          <!--</el-tree>-->\n\n          <el-tree :data=\"data5\"\n                   show-checkbox\n                   node-key=\"value\"\n                   ref=\"tree\"\n                   default-expand-all\n                   :expand-on-click-node=\"true\"\n                   :check-strictly=\"true\">\n            <span class=\"custom-tree-node\"\n                  slot-scope=\"{ node, data }\">\n              <span>{{ node.label }}</span>\n              <span>\n                <el-checkbox-group v-model=\"assignBtns\">\n                  <el-checkbox v-for=\"btn in data.btns\"\n                               :key=\"btn.value\"\n                               :label=\"btn.value.toString()\">\n                    {{btn.label}}\n                  </el-checkbox>\n                </el-checkbox-group>\n\n              </span>\n            </span>\n          </el-tree>\n        </div>\n      </el-card>\n\n    </el-col>\n\n  </section>\n</template>\n\n<script>\nimport util from '../../../util/date'\nimport { getAllRole, getRoleListPage, getPermissionTree, getPermissionIds, addRolePermission } from '../../api/api';\n\nlet id = 1000;\n\nexport default {\n  data () {\n\n    const data = [];\n    return {\n      tableHeight: window.innerHeight - 140, // 控制表格的高度\n      roles: [],\n      roleid: 0,\n      data5: [],\n      btns: [],\n      assigns: [],\n      checked1: false,\n      loadingSaveStr: '保存',\n      loadingSave: false,\n      assignBtns: [],\n      defaultProps: {\n        children: 'children',\n        label: 'label',\n        btns: 'btns',\n      },\n      selectedPermissions: [],\n      currentRoleCode: \"\",\n      stores: {\n        role: {\n          data: []\n        },\n        permissionTree: {\n          data: []\n        }\n      },\n      buttonProps: {\n        type: \"default\",\n        size: \"small\"\n      }\n\n      ,\n      selectRole: {},\n      menuData: [],\n      menuSelections: [],\n      menuLoading: false,\n      authLoading: false,\n      checkAll: false,\n      currentRoleMenus: [],\n    }\n  },\n  methods: {\n    //性别显示转换\n    formatEnabled: function (row, column) {\n      return row.Enabled ? '正常' : '未知';\n    },\n    formatCreateTime: function (row, column) {\n      return (!row.CreateTime || row.CreateTime == '') ? '' : util.formatDate.format(new Date(row.CreateTime), 'yyyy-MM-dd');\n    },\n    //获取角色列表\n    getRoles () {\n      getAllRole().then((res) => {\n        this.roles = res.data.response;\n        this.getPermissions();\n      });\n    },\n    //获取菜单树\n    getPermissions () {\n      let _this = this;\n      let para = { needbtn: false }\n      getPermissionTree(para).then((res) => {\n        _this.loadingSave = false;\n        _this.loadingSaveStr = '保存';\n        this.data = res.data.response.children;\n        this.data5 = JSON.parse(JSON.stringify(this.data));\n      });\n    },\n    //获取菜单Id，通过角色id\n    getPermissionIds (rid) {\n      let _this = this;\n      this.assigns = [];\n      this.assignBtns = [];\n      let para = { rid: rid }\n      getPermissionIds(para).then((res) => {\n\n        _this.loadingSave = false;\n        _this.loadingSaveStr = '保存';\n        this.$refs.tree.setCheckedKeys(res.data.response.permissionids);\n        this.assignBtns = res.data.response.assignbtns;\n\n      });\n    },\n    operate (id) {\n\n      this.loadingSave = true;\n      this.loadingSaveStr = '加载中...';\n      this.roleid = id;\n      this.getPermissionIds(id);\n    },\n    saveAssign () {\n\n      let _this = this;\n      this.loadingSave = true;\n      this.loadingSaveStr = '保存中...';\n      //console.log(this.$refs.tree.getCheckedKeys());\n      //console.log(this.assignBtns)\n      let pids = this.$refs.tree.getCheckedKeys();\n      try {\n        if (this.assignBtns.length > 0) {\n          for (let i = 0; i < this.assignBtns.length; i++) {\n            // let assginbtn = this.assignBtns[i].split(\"_\")[1];\n            let assginbtn = this.assignBtns[i];\n            if (assginbtn && assginbtn > 0) {\n              pids.push(assginbtn);\n            }\n          }\n        }\n      } catch (e) {\n\n      }\n      let para = { pids: pids, rid: this.roleid }\n      if (para.rid > 0 && para.pids.length > 0) {\n        addRolePermission(para).then((res) => {\n\n          _this.loadingSave = false;\n          _this.loadingSaveStr = '保存';\n\n          if (res.data.success) {\n\n            this.$message({\n              message: res.data.msg,\n              type: 'success'\n            });\n\n            let para = { rid: this.roleid }\n            getPermissionIds(para).then((res) => {\n\n              this.$refs.tree.setCheckedKeys(res.data.response.permissionids);\n              this.assignBtns = res.data.response.assignbtns;\n              this.$message({\n                message: \"数据更新成功\",\n                type: 'success'\n              });\n            });\n          } else {\n            this.$message({\n              message: res.data.msg,\n              type: 'error'\n            });\n          }\n        });\n      } else {\n\n        this.loadingSaveStr = '保存';\n        this.loadingSave = false;\n        this.$message({\n          message: \"参数错误\",\n          type: 'error'\n        });\n      }\n    },\n    append (data) {\n      const newChild = { id: id++, label: 'testtest', children: [] };\n      if (!data.children) {\n        this.$set(data, 'children', []);\n      }\n      data.children.push(newChild);\n    },\n\n    remove (node, data) {\n      const parent = node.parent;\n      const children = parent.data.children || parent.data;\n      const index = children.findIndex(d => d.id === data.id);\n      children.splice(index, 1);\n    },\n    // 获取数据\n    findTreeData: function () {\n      this.menuLoading = true\n      this.$api.menu.findMenuTree().then((res) => {\n        this.menuData = res.data\n        this.menuLoading = false\n      })\n    },\n    // 角色选择改变监听\n    handleRoleSelectChange (val) {\n      if (val == null || val.val == null) {\n        return\n      }\n      this.selectRole = val.val\n      this.$api.role.findRoleMenus({ 'roleId': val.val.id }).then((res) => {\n        this.currentRoleMenus = res.data\n        this.$refs.menuTree.setCheckedNodes(res.data)\n      })\n    },\n    // 树节点选择监听\n    handleMenuCheckChange (data, check, subCheck) {\n      if (check) {\n        // 节点选中时同步选中父节点\n        let parentId = data.parentId\n        this.$refs.menuTree.setChecked(parentId, true, false)\n      } else {\n        // 节点取消选中时同步取消选中子节点\n        if (data.children != null) {\n          data.children.forEach(element => {\n            this.$refs.menuTree.setChecked(element.id, false, false)\n          });\n        }\n      }\n    },\n    // 递归全选\n    checkAllMenu (menuData, allMenus) {\n      menuData.forEach(menu => {\n        allMenus.push(menu)\n        if (menu.children) {\n          this.checkAllMenu(menu.children, allMenus)\n        }\n      });\n    },\n    // 角色菜单授权提交\n    submitAuthForm () {\n      let roleId = this.selectRole.id\n      if ('admin' == this.selectRole.name) {\n        this.$message({ message: '超级管理员拥有所有菜单权限，不允许修改！', type: 'error' })\n        return\n      }\n      this.authLoading = true\n      let checkedNodes = this.$refs.menuTree.getCheckedNodes(false, true)\n      let roleMenus = []\n      for (let i = 0, len = checkedNodes.length; i < len; i++) {\n        let roleMenu = { roleId: roleId, menuId: checkedNodes[i].id }\n        roleMenus.push(roleMenu)\n      }\n      this.$api.role.saveRoleMenus(roleMenus).then((res) => {\n        if (res.code == 200) {\n          this.$message({ message: '操作成功', type: 'success' })\n        } else {\n          this.$message({ message: '操作失败, ' + res.msg, type: 'error' })\n        }\n        this.authLoading = false\n      })\n    },\n    renderContent (h, { node, data, store }) {\n      return (\n        <div class=\"column-container\">\n          <span style=\"text-algin:center;margin-right:80px;\">{data.label}</span>\n          <span style=\"text-algin:center;margin-right:80px;\">\n            <el-tag type={data.isbtn ? 'success' : 'info'} size=\"small\">\n              {!data.isbtn ? '菜单' : '按钮'}\n            </el-tag>\n          </span>\n\n        </div>);\n    },\n    // 时间格式化\n    dateFormat: function (row, column, cellValue, index) {\n      return format(row[column.property])\n    }\n\n\n  },\n  mounted () {\n    this.loadingSave = true;\n    this.loadingSaveStr = '加载中...';\n    this.getRoles();\n\n    // this.getPermissions();\n  }\n}\n\n</script>\n<style scoped>\n.content-az {\n  height: calc(\n    100% - 61px\n  ) !important; /* 修改该样式，改为1px [EditBy shaocx,2021-02-02] */\n}\n</style>\n<style >\n.role-item {\n  cursor: pointer;\n  padding: 10px;\n}\n\n.role-item.active {\n  background: #ebf5ff;\n}\n\n.role-item:hover {\n  background: #ebf5ff;\n}\n\n.custom-tree-node {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-size: 14px;\n  padding-right: 8px;\n}\n\n.text {\n  font-size: 14px;\n}\n\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n\n.clearfix:after {\n  clear: both;\n}\n\n.box-card {\n  width: 90%;\n}\n\n.morechildren .el-checkbox {\n  margin-right: 5px !important;\n  float: left;\n}\n.morechildren .el-checkbox-group {\n  margin-left: 50px;\n  padding: 5px;\n}\n.morechildren .el-tree-node__content {\n  height: auto !important;\n}\n</style>\n"]}]}